#!/bin/sh

# Redirect output to stderr.
exec 1>&2

# Check if markdownlint is installed
if ! command -v markdownlint &> /dev/null; then
    echo "markdownlint could not be found."
    echo "Please install it with: npm install -g markdownlint-cli"
    exit 1
fi

# Get list of staged markdown files
STAGED_MD_FILES=$(git diff --cached --name-only --diff-filter=ACMRT | grep "\.md$" | tr '\n' ' ')

if [ -z "$STAGED_MD_FILES" ]; then
    # No Markdown files to check
    exit 0
fi

echo "Checking Markdown files for linting issues..."

# Run markdownlint on staged markdown files
if ! markdownlint -c .markdownlint.json $STAGED_MD_FILES; then
    echo "Markdown linting failed! Please fix the issues before committing."
    echo "You can run 'markdownlint -c .markdownlint.json file.md' to check specific files."
    echo "To bypass this check, commit with --no-verify"
    exit 1
fi

exit 0
