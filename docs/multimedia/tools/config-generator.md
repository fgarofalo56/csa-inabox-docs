# ‚öôÔ∏è Configuration Generator Tool

> **üè† [Home](../../../README.md)** | **üìñ [Documentation](../../README.md)** | **üé¨ [Multimedia](../README.md)** | **üõ†Ô∏è [Tools](README.md)** | **‚öôÔ∏è Config Generator**

![Status: Active](https://img.shields.io/badge/Status-Active-brightgreen)
![Type: Utility](https://img.shields.io/badge/Type-Utility-blue)
![Complexity: Intermediate](https://img.shields.io/badge/Complexity-Intermediate-yellow)

## üìã Overview

Command-line tool for generating configuration files for multimedia processing pipelines, Azure services integration, and automation workflows. Supports template-based configuration with validation and Azure-specific optimizations.

## üöÄ Quick Start

### Installation

```bash
# NPM
npm install -g @csa/config-generator

# Yarn
yarn global add @csa/config-generator

# Verify installation
csa-config --version
```

### Basic Usage

```bash
# Generate default configuration
csa-config generate --output multimedia-config.yaml

# Generate from template
csa-config generate --template video-pipeline --output config.yaml

# Generate for specific Azure service
csa-config generate --service synapse-media --output synapse-config.yaml

# Interactive configuration wizard
csa-config init --interactive
```

## üì¶ Configuration Templates

### Available Templates

| Template | Description | Use Case |
|----------|-------------|----------|
| `video-pipeline` | Video processing workflow | Video transcoding, optimization |
| `image-optimization` | Batch image processing | Image compression, format conversion |
| `audio-processing` | Audio enhancement pipeline | Noise reduction, transcription |
| `accessibility` | Accessibility validation | Caption validation, alt text |
| `azure-media-services` | Azure Media Services | Streaming, encoding |
| `cdn-delivery` | Azure CDN configuration | Content delivery optimization |
| `monitoring` | Analytics and monitoring | Usage tracking, performance |

### Template Examples

#### Video Pipeline Template

```bash
csa-config generate --template video-pipeline --output video-config.yaml
```

Generated `video-config.yaml`:

```yaml
# Video Processing Pipeline Configuration
# Generated by @csa/config-generator v1.0.0

pipeline:
  name: "video-processing-pipeline"
  version: "1.0"
  description: "Automated video processing for documentation"

input:
  directory: "./videos/raw"
  patterns: ["*.mp4", "*.mov", "*.avi"]
  recursive: true

processing:
  transcode:
    enabled: true
    formats:
      - format: "mp4"
        codec: "h264"
        preset: "slow"
        crf: 23
        audio_codec: "aac"
        audio_bitrate: "128k"

      - format: "webm"
        codec: "vp9"
        preset: "medium"
        crf: 30
        audio_codec: "opus"
        audio_bitrate: "128k"

  resize:
    enabled: true
    resolutions:
      - width: 1920
        height: 1080
        label: "1080p"
      - width: 1280
        height: 720
        label: "720p"
      - width: 854
        height: 480
        label: "480p"

  branding:
    enabled: true
    intro:
      file: "./assets/intro-5s.mp4"
      duration: 5
    outro:
      file: "./assets/outro-5s.mp4"
      duration: 5
    watermark:
      file: "./assets/logo-watermark.png"
      position: "bottom-right"
      opacity: 0.7

  captions:
    enabled: true
    generate: true
    languages: ["en-US"]
    formats: ["srt", "vtt"]
    azure_speech:
      enabled: true
      region: "eastus"

  thumbnails:
    enabled: true
    interval: 10  # seconds
    format: "jpg"
    quality: 85

output:
  directory: "./videos/processed"
  naming_convention: "{filename}-{resolution}-{timestamp}"
  metadata:
    include: true
    fields: ["title", "description", "tags", "duration"]

azure:
  enabled: true
  storage:
    account: "${AZURE_STORAGE_ACCOUNT}"
    container: "multimedia-videos"
    upload_after_processing: true
    public_access: "blob"

  media_services:
    enabled: false
    account_name: "${AZURE_MEDIA_ACCOUNT}"
    resource_group: "csa-multimedia"

  cdn:
    enabled: true
    profile: "csa-cdn"
    endpoint: "csa-videos"
    purge_on_upload: true

monitoring:
  enabled: true
  log_level: "info"
  azure_application_insights:
    enabled: true
    connection_string: "${APPINSIGHTS_CONNECTION_STRING}"

  metrics:
    - processing_time
    - file_size
    - bitrate
    - resolution
    - failures

notifications:
  enabled: true
  on_complete: true
  on_error: true
  channels:
    email:
      enabled: false
      recipients: []
    teams:
      enabled: true
      webhook_url: "${TEAMS_WEBHOOK_URL}"
    slack:
      enabled: false
      webhook_url: "${SLACK_WEBHOOK_URL}"

performance:
  parallel_processing: true
  max_concurrent: 4
  timeout: 3600  # seconds
  retry_on_failure: true
  max_retries: 3

validation:
  enabled: true
  checks:
    - video_codec
    - audio_codec
    - resolution
    - bitrate
    - duration
  fail_on_validation_error: false
```

#### Image Optimization Template

```bash
csa-config generate --template image-optimization --output image-config.yaml
```

Generated `image-config.yaml`:

```yaml
# Image Optimization Configuration
# Generated by @csa/config-generator v1.0.0

optimization:
  name: "image-optimization-pipeline"
  version: "1.0"

input:
  directory: "./images/source"
  patterns: ["*.png", "*.jpg", "*.jpeg"]
  recursive: true
  exclude_patterns: ["*-optimized.*", "*-thumb.*"]

processing:
  compression:
    enabled: true
    quality: 85
    progressive: true
    strip_metadata: false  # Keep for attribution

  format_conversion:
    enabled: true
    formats:
      - format: "webp"
        quality: 85
        lossless: false
      - format: "avif"
        quality: 80
        speed: 6
    keep_original: true

  resize:
    enabled: true
    sizes:
      - width: 1920
        height: null  # maintain aspect ratio
        suffix: "-fullhd"
      - width: 1280
        height: null
        suffix: "-hd"
      - width: 640
        height: null
        suffix: "-mobile"
      - width: 320
        height: null
        suffix: "-thumb"

  optimization:
    png:
      tool: "pngquant"
      quality_range: [65, 85]
      speed: 3
    jpeg:
      tool: "mozjpeg"
      quality: 85
      progressive: true
    svg:
      tool: "svgo"
      plugins:
        - removeViewBox: false
        - removeDimensions: true

output:
  directory: "./images/optimized"
  structure: "mirror"  # mirror source structure
  naming:
    pattern: "{filename}{suffix}.{extension}"

  srcset:
    generate: true
    output_file: "srcset-mappings.json"

azure:
  enabled: true
  storage:
    account: "${AZURE_STORAGE_ACCOUNT}"
    container: "multimedia-images"
    path_prefix: "optimized/"

  cdn:
    enabled: true
    profile: "csa-cdn"
    endpoint: "csa-images"
    custom_domain: "images.csa.azure.com"

  computer_vision:
    enabled: true
    auto_generate_alt_text: true
    detect_faces: false
    detect_objects: true
    output_file: "alt-text-generated.json"

accessibility:
  validate_alt_text: true
  require_alt_text: true
  min_alt_length: 10
  max_alt_length: 125

validation:
  enabled: true
  rules:
    max_file_size: 500KB
    min_width: 320
    max_width: 3840
    allowed_formats: ["png", "jpg", "jpeg", "webp", "avif", "svg"]

  output_report: true
  report_format: "html"

monitoring:
  log_level: "info"
  track_metrics:
    - original_size
    - optimized_size
    - compression_ratio
    - processing_time

  azure_insights:
    enabled: true
    connection_string: "${APPINSIGHTS_CONNECTION_STRING}"
```

## üéØ Configuration Options

### Global Options

```bash
# Generate with custom values
csa-config generate \
  --template video-pipeline \
  --set azure.enabled=true \
  --set azure.region=eastus \
  --set processing.parallel=4 \
  --output config.yaml

# Use environment variables
csa-config generate \
  --template video-pipeline \
  --env-file .env.production \
  --output config.yaml

# Merge multiple configs
csa-config merge base-config.yaml overrides.yaml --output final-config.yaml
```

### Azure-Specific Options

```bash
# Generate Azure Media Services config
csa-config generate \
  --service azure-media-services \
  --subscription-id "${AZURE_SUBSCRIPTION_ID}" \
  --resource-group "csa-multimedia" \
  --location "eastus" \
  --output azure-media-config.yaml

# Generate Azure Storage config
csa-config generate \
  --service azure-storage \
  --storage-account "csamediastorage" \
  --container "multimedia" \
  --output azure-storage-config.yaml

# Generate Azure CDN config
csa-config generate \
  --service azure-cdn \
  --profile "csa-cdn" \
  --endpoint "csa-content" \
  --custom-domain "cdn.csa.azure.com" \
  --output azure-cdn-config.yaml
```

## üîç Configuration Validation

### Validate Configuration Files

```bash
# Validate configuration
csa-config validate config.yaml

# Validate with specific schema
csa-config validate config.yaml --schema video-pipeline

# Validate multiple files
csa-config validate *.yaml --recursive

# Output validation report
csa-config validate config.yaml --report validation-report.html
```

### Example Validation Output

```text
‚úÖ Validating: multimedia-config.yaml

Schema: video-pipeline v1.0
Standard: CSA Multimedia Config v2.0

Validation Results:
‚úÖ Structure: Valid
‚úÖ Required fields: All present
‚úÖ Azure configuration: Valid
‚ö†Ô∏è  Performance: max_concurrent=8 may cause resource issues (recommended: 4)
‚úÖ Output paths: Valid and writable
‚ùå azure.storage.account: Environment variable AZURE_STORAGE_ACCOUNT not set

Overall: PASS with warnings

Issues:
1. [WARNING] High concurrency setting may impact system resources
2. [ERROR] Missing required environment variable

Suggestions:
- Set AZURE_STORAGE_ACCOUNT in environment or .env file
- Consider reducing max_concurrent to 4 for better stability
```

## üîß Advanced Features

### Custom Templates

Create custom configuration templates:

```bash
# Create new template
csa-config template create my-custom-pipeline --base video-pipeline

# Edit template
csa-config template edit my-custom-pipeline

# List templates
csa-config template list

# Export template
csa-config template export my-custom-pipeline --output my-template.yaml
```

**Custom Template Example:**

```yaml
# ~/.csa/templates/my-custom-pipeline.yaml
template:
  name: "my-custom-pipeline"
  description: "Custom video processing with branding"
  version: "1.0"
  extends: "video-pipeline"

overrides:
  branding:
    enabled: true
    company_logo: "./assets/company-logo.png"
    intro_music: "./assets/intro-music.mp3"

  processing:
    custom_filters:
      - name: "color_correction"
        enabled: true
        brightness: 1.1
        contrast: 1.05
      - name: "denoise"
        enabled: true
        strength: 0.5

variables:
  - name: "company_name"
    description: "Company name for branding"
    required: true
  - name: "quality_preset"
    description: "Quality preset (low|medium|high)"
    default: "high"
    options: ["low", "medium", "high"]
```

### Environment Profiles

Manage environment-specific configurations:

```bash
# Generate for development
csa-config generate --profile development --output dev-config.yaml

# Generate for production
csa-config generate --profile production --output prod-config.yaml

# Create custom profile
csa-config profile create staging --base production
```

**Profile Configuration:**

```yaml
# ~/.csa/profiles/production.yaml
profile:
  name: "production"
  description: "Production environment configuration"

defaults:
  azure:
    enabled: true
    region: "eastus"
    environment: "production"

  performance:
    parallel_processing: true
    max_concurrent: 8

  monitoring:
    enabled: true
    log_level: "warning"

  validation:
    enabled: true
    fail_on_error: true

overrides:
  processing:
    quality: 95
    optimization_level: "maximum"
```

### Interactive Configuration Wizard

```bash
# Launch interactive wizard
csa-config init --interactive
```

**Example Wizard Session:**

```text
üé¨ CSA Multimedia Configuration Wizard

What type of content will you be processing?
  1. Videos
  2. Images
  3. Audio
  4. Mixed (videos and images)
‚ñ∏ 1. Videos

Where are your source files located?
‚ñ∏ ./videos/raw

Which output formats do you need?
  ‚òë MP4 (H.264)
  ‚òë WebM (VP9)
  ‚òê HLS
  ‚òê DASH

Do you want to use Azure services?
‚ñ∏ Yes

Enter your Azure storage account name:
‚ñ∏ csamediastorage

Enter your Azure storage container:
‚ñ∏ multimedia-videos

Do you want to enable Azure CDN?
‚ñ∏ Yes

Enable accessibility features (captions, transcripts)?
‚ñ∏ Yes

Generate configuration file?
‚ñ∏ Yes

‚úÖ Configuration generated: multimedia-config.yaml
‚úÖ Environment template created: .env.template

Next steps:
1. Review generated configuration
2. Set environment variables in .env file
3. Run: csa-media process --config multimedia-config.yaml
```

## üìä Configuration Schemas

### JSON Schema

Export configuration schema for validation:

```bash
# Export JSON schema
csa-config schema export --type video-pipeline --output schema.json

# Generate TypeScript types
csa-config schema types --output config.types.ts

# Generate documentation
csa-config schema docs --output schema-docs.md
```

### Schema Versioning

```bash
# List schema versions
csa-config schema versions

# Use specific schema version
csa-config generate --schema-version 2.0 --output config.yaml

# Migrate configuration
csa-config migrate config-v1.yaml --to-version 2.0 --output config-v2.yaml
```

## üîó Integration Examples

### Node.js

```javascript
const { ConfigGenerator } = require('@csa/config-generator');

const generator = new ConfigGenerator({
  template: 'video-pipeline',
  profile: 'production'
});

// Generate configuration
const config = await generator.generate({
  azure: {
    storageAccount: process.env.AZURE_STORAGE_ACCOUNT,
    container: 'multimedia-videos'
  },
  processing: {
    parallel: true,
    maxConcurrent: 4
  }
});

// Validate configuration
const validation = await generator.validate(config);
if (!validation.valid) {
  console.error('Configuration errors:', validation.errors);
}

// Save configuration
await generator.save(config, './config.yaml');
```

### Python

```python
from csa_config_generator import ConfigGenerator

# Create generator
generator = ConfigGenerator(
    template='video-pipeline',
    profile='production'
)

# Generate configuration
config = generator.generate(
    azure={
        'storage_account': os.getenv('AZURE_STORAGE_ACCOUNT'),
        'container': 'multimedia-videos'
    },
    processing={
        'parallel': True,
        'max_concurrent': 4
    }
)

# Validate
validation = generator.validate(config)
if not validation['valid']:
    print('Configuration errors:', validation['errors'])

# Save
generator.save(config, './config.yaml')
```

### GitHub Actions

```yaml
# .github/workflows/generate-config.yml
name: Generate Configuration

on:
  workflow_dispatch:
    inputs:
      environment:
        description: 'Target environment'
        required: true
        type: choice
        options:
          - development
          - staging
          - production

jobs:
  generate:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3

      - name: Install Config Generator
        run: npm install -g @csa/config-generator

      - name: Generate Configuration
        run: |
          csa-config generate \
            --template video-pipeline \
            --profile ${{ github.event.inputs.environment }} \
            --set azure.storage.account="${{ secrets.AZURE_STORAGE_ACCOUNT }}" \
            --output config-${{ github.event.inputs.environment }}.yaml

      - name: Validate Configuration
        run: csa-config validate config-${{ github.event.inputs.environment }}.yaml

      - name: Upload Configuration
        uses: actions/upload-artifact@v3
        with:
          name: configuration
          path: config-${{ github.event.inputs.environment }}.yaml
```

## üìö Related Resources

- [Tools Overview](README.md)
- [Video Production Guide](../production-guide/video-production-workflow.md)
- [Image Optimization](image-optimization.md)
- [Azure Media Services](https://azure.microsoft.com/services/media-services/)

## üîó Documentation

- [API Reference](https://docs.csa.azure.com/api/config-generator)
- [Configuration Schema](https://docs.csa.azure.com/schemas/multimedia-config)
- [Template Library](https://github.com/csa-inabox/config-templates)

---

*Last Updated: January 2025 | Version: 1.0.0*
