<?xml version="1.0" encoding="UTF-8"?>
<svg viewBox="0 0 1200 800" xmlns="http://www.w3.org/2000/svg">
  <defs>
    <style>
      .title { font: bold 24px Arial, sans-serif; text-anchor: middle; fill: #0078D4; }
      .service-box { fill: #F3E5F5; stroke: #9C27B0; stroke-width: 2; rx: 8; }
      .service-text { font: 14px Arial, sans-serif; text-anchor: middle; fill: #333; }
      .service-title { font: bold 16px Arial, sans-serif; text-anchor: middle; fill: #9C27B0; }
      .arrow { fill: none; stroke: #9C27B0; stroke-width: 2; marker-end: url(#arrowhead); }
      .bi-arrow { fill: none; stroke: #FF5722; stroke-width: 2; marker-end: url(#arrowhead2); marker-start: url(#arrowhead2); }
      .zone-title { font: bold 18px Arial, sans-serif; text-anchor: middle; fill: #666; }
      .zone-box { fill: none; stroke: #999; stroke-width: 1; stroke-dasharray: 8,4; rx: 12; }
      .metadata-box { fill: #FFECB3; stroke: #FFC107; stroke-width: 2; rx: 8; }
      .sync-arrow { fill: none; stroke: #4CAF50; stroke-width: 3; stroke-dasharray: 3,3; }
    </style>
    <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="10" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#9C27B0" />
    </marker>
    <marker id="arrowhead2" markerWidth="10" markerHeight="7" refX="10" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#FF5722" />
    </marker>
  </defs>

  <!-- Title -->
  <text x="600" y="30" class="title">Shared Metadata Architecture</text>

  <!-- Spark Engine Zone -->
  <rect x="50" y="80" width="300" height="300" class="zone-box"/>
  <text x="200" y="105" class="zone-title">Apache Spark Engine</text>
  
  <!-- Spark Session -->
  <rect x="70" y="130" width="130" height="50" class="service-box"/>
  <text x="135" y="150" class="service-title">Spark Session</text>
  <text x="135" y="165" class="service-text">Spark Context</text>
  
  <!-- Spark Catalog -->
  <rect x="210" y="130" width="130" height="50" class="service-box"/>
  <text x="275" y="150" class="service-title">Spark Catalog</text>
  <text x="275" y="165" class="service-text">Table Registry</text>
  
  <!-- DataFrames -->
  <rect x="70" y="200" width="130" height="50" class="service-box"/>
  <text x="135" y="220" class="service-title">DataFrames</text>
  <text x="135" y="235" class="service-text">Schema Info</text>
  
  <!-- Spark SQL -->
  <rect x="210" y="200" width="130" height="50" class="service-box"/>
  <text x="275" y="220" class="service-title">Spark SQL</text>
  <text x="275" y="235" class="service-text">Query Engine</text>
  
  <!-- Delta Lake Integration -->
  <rect x="140" y="270" width="130" height="50" class="service-box"/>
  <text x="205" y="290" class="service-title">Delta Lake</text>
  <text x="205" y="305" class="service-text">ACID Operations</text>
  
  <!-- Notebooks -->
  <rect x="70" y="340" width="130" height="40" class="service-box"/>
  <text x="135" y="365" class="service-text">PySpark Notebooks</text>
  
  <!-- Spark Jobs -->
  <rect x="210" y="340" width="130" height="40" class="service-box"/>
  <text x="275" y="365" class="service-text">Spark Jobs</text>

  <!-- Central Metastore Zone -->
  <rect x="400" y="180" width="400" height="320" class="zone-box"/>
  <text x="600" y="205" class="zone-title">Shared Metastore</text>
  
  <!-- Hive Metastore -->
  <rect x="420" y="230" width="180" height="80" class="metadata-box"/>
  <text x="510" y="250" class="service-title">Hive Metastore</text>
  <text x="510" y="268" class="service-text">• Database Schemas</text>
  <text x="510" y="282" class="service-text">• Table Definitions</text>
  <text x="510" y="296" class="service-text">• Partition Info</text>
  
  <!-- External Metastore -->
  <rect x="620" y="230" width="160" height="80" class="metadata-box"/>
  <text x="700" y="250" class="service-title">External Metastore</text>
  <text x="700" y="268" class="service-text">• Custom Catalogs</text>
  <text x="700" y="282" class="service-text">• Unity Catalog</text>
  <text x="700" y="296" class="service-text">• Apache Iceberg</text>
  
  <!-- Schema Repository -->
  <rect x="420" y="330" width="360" height="60" class="metadata-box"/>
  <text x="600" y="350" class="service-title">Schema Repository</text>
  <text x="520" y="370" class="service-text">• Column Definitions</text>
  <text x="680" y="370" class="service-text">• Data Types & Constraints</text>
  
  <!-- Metadata Synchronization -->
  <rect x="420" y="410" width="360" height="60" class="metadata-box"/>
  <text x="600" y="430" class="service-title">Metadata Synchronization</text>
  <text x="520" y="450" class="service-text">• Cross-Engine Sync</text>
  <text x="680" y="450" class="service-text">• Schema Evolution</text>

  <!-- SQL Engine Zone -->
  <rect x="850" y="80" width="300" height="300" class="zone-box"/>
  <text x="1000" y="105" class="zone-title">Serverless SQL Pool</text>
  
  <!-- SQL Connection -->
  <rect x="870" y="130" width="130" height="50" class="service-box"/>
  <text x="935" y="150" class="service-title">TDS Endpoint</text>
  <text x="935" y="165" class="service-text">SQL Connection</text>
  
  <!-- External Tables -->
  <rect x="1010" y="130" width="130" height="50" class="service-box"/>
  <text x="1075" y="150" class="service-title">External Tables</text>
  <text x="1075" y="165" class="service-text">Schema-on-Read</text>
  
  <!-- SQL Views -->
  <rect x="870" y="200" width="130" height="50" class="service-box"/>
  <text x="935" y="220" class="service-title">Views</text>
  <text x="935" y="235" class="service-text">Virtual Tables</text>
  
  <!-- Stored Procedures -->
  <rect x="1010" y="200" width="130" height="50" class="service-box"/>
  <text x="1075" y="220" class="service-title">Stored Procs</text>
  <text x="1075" y="235" class="service-text">Business Logic</text>
  
  <!-- SQL Database -->
  <rect x="940" y="270" width="130" height="50" class="service-box"/>
  <text x="1005" y="290" class="service-title">SQL Database</text>
  <text x="1005" y="305" class="service-text">Object Registry</text>
  
  <!-- Client Tools -->
  <rect x="870" y="340" width="130" height="40" class="service-box"/>
  <text x="935" y="365" class="service-text">SSMS, Power BI</text>
  
  <!-- Custom Applications -->
  <rect x="1010" y="340" width="130" height="40" class="service-box"/>
  <text x="1075" y="365" class="service-text">Custom Apps</text>

  <!-- Data Storage Zone -->
  <rect x="400" y="520" width="400" height="180" class="zone-box"/>
  <text x="600" y="545" class="zone-title">Data Storage Layer</text>
  
  <!-- Azure Data Lake Storage Gen2 -->
  <rect x="420" y="570" width="360" height="60" class="metadata-box"/>
  <text x="600" y="590" class="service-title">Azure Data Lake Storage Gen2</text>
  <text x="520" y="610" class="service-text">• Delta Tables</text>
  <text x="600" y="610" class="service-text">• Parquet Files</text>
  <text x="680" y="610" class="service-text">• Raw Data</text>
  
  <!-- File System Hierarchy -->
  <rect x="420" y="650" width="110" height="40" class="service-box"/>
  <text x="475" y="675" class="service-text">Databases</text>
  
  <rect x="540" y="650" width="110" height="40" class="service-box"/>
  <text x="595" y="675" class="service-text">Tables</text>
  
  <rect x="660" y="650" width="120" height="40" class="service-box"/>
  <text x="720" y="675" class="service-text">Partitions</text>

  <!-- Connection Arrows -->
  <!-- Spark to Metastore -->
  <path d="M 350 240 L 400 240" class="arrow"/>
  <path d="M 350 270 L 400 290" class="arrow"/>
  
  <!-- SQL to Metastore -->
  <path d="M 850 240 L 800 240" class="arrow"/>
  <path d="M 850 270 L 800 290" class="arrow"/>
  
  <!-- Bi-directional sync -->
  <path d="M 400 350 L 350 350 Q 200 350 200 400 L 200 520 L 600 520" class="bi-arrow"/>
  <path d="M 800 350 L 850 350 Q 1000 350 1000 400 L 1000 520 L 600 520" class="bi-arrow"/>
  
  <!-- Metastore to Storage -->
  <path d="M 600 500 L 600 520" class="arrow"/>
  
  <!-- Internal metastore connections -->
  <path d="M 510 310 L 510 330" class="sync-arrow"/>
  <path d="M 700 310 L 700 330" class="sync-arrow"/>
  <path d="M 600 390 L 600 410" class="sync-arrow"/>

  <!-- Benefits Section -->
  <rect x="50" y="730" width="1100" height="50" class="zone-box"/>
  <text x="600" y="750" class="zone-title">Shared Metadata Benefits</text>
  <text x="150" y="770" class="service-text">• Unified Data View</text>
  <text x="350" y="770" class="service-text">• Cross-Engine Compatibility</text>
  <text x="550" y="770" class="service-text">• Schema Evolution</text>
  <text x="750" y="770" class="service-text">• Governance Integration</text>
  <text x="950" y="770" class="service-text">• Single Source of Truth</text>

  <!-- Metadata Flow Legend -->
  <rect x="50" y="420" width="320" height="80" class="zone-box"/>
  <text x="210" y="440" class="zone-title">Metadata Flow Patterns</text>
  
  <line x1="70" y1="455" x2="100" y2="455" class="arrow"/>
  <text x="110" y="460" class="service-text">Schema Registration</text>
  
  <line x1="70" y1="470" x2="100" y2="470" class="bi-arrow"/>
  <text x="110" y="475" class="service-text">Bi-directional Sync</text>
  
  <line x1="70" y1="485" x2="100" y2="485" class="sync-arrow"/>
  <text x="110" y="490" class="service-text">Automatic Updates</text>
</svg>